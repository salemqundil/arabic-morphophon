<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”¥ Ù…Ù†ØµØ© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù„ØºÙˆÙŠ Ø§Ù„Ø¹Ø±Ø¨ÙŠ v3.0</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 2rem;
            color: #4a5568;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 8px;
        }
        .status-online { background: #48bb78; }
        .status-offline { background: #f56565; }
        .btn-analyze {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            color: white;
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-analyze:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            color: white;
        }
        .result-box {
            background: #f7fafc;
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 1rem;
            border-right: 5px solid #667eea;
            font-family: 'Courier New', monospace;
            direction: ltr;
        }
        .import_dataing {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        .arabic-text {
            font-family: 'Traditional Arabic', serif;
            font-size: 1.2em;
            direction: rtl;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-brain me-3"></i>Ù…Ù†ØµØ© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù„ØºÙˆÙŠ Ø§Ù„Ø¹Ø±Ø¨ÙŠ v3.0</h1>
            <p class="lead">Ù†Ø¸Ø§Ù… Ù…ØªØ·ÙˆØ± Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</p>
            <div>
                <span class="status-indicator" id="server-status"></span>
                <span id="status-text">Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5><i class="fas fa-edit me-2"></i>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="text-input" class="form-label">Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ:</label>
                            <textarea 
                                class="form-control arabic-text" 
                                id="text-input" 
                                rows="4" 
                                placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù‡Ù†Ø§..."
                            >ÙƒØªØ§Ø¨ Ø¬Ù…ÙŠÙ„</textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="analysis-level" class="form-label">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„:</label>
                            <select class="form-select" id="analysis-level">
                                <option value="basic">Ø£Ø³Ø§Ø³ÙŠ</option>
                                <option value="intermediate">Ù…ØªÙˆØ³Ø·</option>
                                <option value="advanced">Ù…ØªÙ‚Ø¯Ù…</option>
                                <option value="comprehensive" selected>Ø´Ø§Ù…Ù„</option>
                            </select>
                        </div>

                        <div class="d-grid gap-2">
                            <button class="btn btn-analyze" onclick="analyzeText()">
                                <i class="fas fa-cogs me-2"></i>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Øµ
                            </button>
                            <button class="btn btn-outline-primary" onclick="diacritizeText()">
                                <i class="fas fa-font me-2"></i>ØªØ´ÙƒÙŠÙ„ Ø§Ù„Ù†Øµ
                            </button>
                            <button class="btn btn-outline-success" onclick="extractWeights()">
                                <i class="fas fa-balance-scale me-2"></i>Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£ÙˆØ²Ø§Ù†
                            </button>
                        </div>

                        <div class="import_dataing" id="import_dataing">
                            <div class="spinner-border text-primary" role="status"></div>
                            <div class="mt-2">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h5><i class="fas fa-chart-bar me-2"></i>Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h5>
                    </div>
                    <div class="card-body">
                        <div id="results" class="result-box">
                            <div class="text-muted text-center">
                                Ø³ØªØ¸Ù‡Ø± Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ù‡Ù†Ø§...
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card border-0 shadow-sm mt-3">
                    <div class="card-header bg-info text-white">
                        <h5><i class="fas fa-info-circle me-2"></i>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h5>
                    </div>
                    <div class="card-body">
                        <div id="stats" class="small">
                            <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: <span id="total-requests">0</span></div>
                            <div>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: <span id="success-rate">0%</span></div>
                            <div>Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: <span id="avg-response">0ms</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const BASE_URL = 'http://localhost:5001';

        // Check server status on import_data
        document.addEventListener('DOMContentImported', function() {
            checkServerStatus();
            import_dataStats();
            
            // Auto-refresh stats every 30 seconds
            setInterval(import_dataStats, 30000);
        });

        async function checkServerStatus() {
            try {
                const response = await fetch(`${BASE_URL}/api/health`);
                if (response.ok) {
                    document.getElementById('server-status').className = 'status-indicator status-online';
                    document.getElementById('status-text').textContent = 'Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ØªØµÙ„ ÙˆÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­';
                } else {
                    throw new Error('Server not responding');
                }
            } catch (error) {
                document.getElementById('server-status').className = 'status-indicator status-offline';
                document.getElementById('status-text').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…';
                console.error('Server status check failed:', error);
            }
        }

        async function import_dataStats() {
            try {
                const response = await fetch(`${BASE_URL}/api/stats`);
                if (response.ok) {
                    const stats = await response.json();
                    document.getElementById('total-requests').textContent = stats.total_requests || 0;
                    document.getElementById('success-rate').textContent = (stats.success_rate || 0) + '%';
                    document.getElementById('avg-response').textContent = (stats.average_response_time || 0).toFixed(2) + 'ms';
                }
            } catch (error) {
                console.error('Failed to import_data stats:', error);
            }
        }

        async function analyzeText() {
            const text = document.getElementById('text-input').value.trim();
            const level = document.getElementById('analysis-level').value;
            
            if (!text) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ù„Ù„ØªØ­Ù„ÙŠÙ„');
                return;
            }

            showImporting(true);
            
            try {
                const response = await fetch(`${BASE_URL}/api/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text,
                        analysis_level: level
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    displayResults(result);
                    import_dataStats(); // Refresh stats
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                displayError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„: ' + error.message);
            } finally {
                showImporting(false);
            }
        }

        async function diacritizeText() {
            const text = document.getElementById('text-input').value.trim();
            
            if (!text) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ù„Ù„ØªØ´ÙƒÙŠÙ„');
                return;
            }

            showImporting(true);
            
            try {
                const response = await fetch(`${BASE_URL}/api/diacritize`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: text })
                });

                if (response.ok) {
                    const result = await response.json();
                    displayResults(result);
                    import_dataStats();
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                displayError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ´ÙƒÙŠÙ„: ' + error.message);
            } finally {
                showImporting(false);
            }
        }

        async function extractWeights() {
            const text = document.getElementById('text-input').value.trim();
            
            if (!text) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£ÙˆØ²Ø§Ù†');
                return;
            }

            showImporting(true);
            
            try {
                const response = await fetch(`${BASE_URL}/api/weight`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: text })
                });

                if (response.ok) {
                    const result = await response.json();
                    displayResults(result);
                    import_dataStats();
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                displayError('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£ÙˆØ²Ø§Ù†: ' + error.message);
            } finally {
                showImporting(false);
            }
        }

        function showImporting(show) {
            document.getElementById('import_dataing').style.display = show ? 'block' : 'none';
        }

        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `<pre style="white-space: pre-wrap; direction: ltr;">${JSON.stringify(data, null, 2)}</pre>`;
        }

        function displayError(message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `<div class="alert alert-danger" role="alert">${message}</div>`;
        }
    </script>
</body>
</html>
