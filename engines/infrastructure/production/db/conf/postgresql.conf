# PostgreSQL production configuration

# Memory settings
shared_buffers = 1GB                  # 25% of RAM for dedicated servers
work_mem = 32MB                       # Per-operation memory
maintenance_work_mem = 256MB          # For maintenance operations
effective_cache_size = 3GB            # 75% of RAM for dedicated servers

# Checkpoint settings
checkpoint_timeout = 15min            # Reduces I/O load
checkpoint_completion_target = 0.9    # Spreads out checkpoint I/O
max_wal_size = 2GB                    # Maximum WAL size before checkpoint
min_wal_size = 1GB                    # Minimum WAL size

# Planner settings
random_page_cost = 1.1                # For SSD storage
effective_io_concurrency = 200        # For SSD storage
default_statistics_target = 100       # For complex queries

# Logging
log_min_duration_statement = 1000     # Log queries taking > 1s
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on
log_temp_files = 0
log_autovacuum_min_duration = 0

# Autovacuum settings
autovacuum = on
autovacuum_vacuum_scale_factor = 0.05  # Vacuum when 5% of rows are dead
autovacuum_analyze_scale_factor = 0.025 # Analyze when 2.5% of rows have changed

# Connection settings
max_connections = 200                  # Adjust based on expected load

# Statement behavior
search_path = '"$user", public'
statement_timeout = 60000              # Timeout after 60s
lock_timeout = 10000                   # Lock timeout after 10s

# SSL settings
ssl = on
ssl_cert_file = '/etc/ssl/certs/ssl-cert-snakeoil.pem'
ssl_key_file = '/etc/ssl/private/ssl-cert-snakeoil.key'
